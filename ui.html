<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
<style>
    /* Font faces imported */
    @font-face { font-family: 'Roboto'; font-style: normal; font-weight: 400; src: local('Roboto'), local('Roboto-Regular'); }
    @font-face { font-family: 'Roboto'; font-style: normal; font-weight: 500; src: local('Roboto Medium'), local('Roboto-Medium'); }
    @font-face { font-family: 'Roboto'; font-style: normal; font-weight: 700; src: local('Roboto Bold'), local('Roboto-Bold'); }
    /* Palette & layout */
    :root {
      --primary-color: #ff4100;
      --primary-hover: #e63a00;
      --error-color: #F24822;
      --success-color: #00a86b;
      --text-color: #333333;
      --border-color: #E5E5E5;
      --background-color: #FFFFFF;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --border-radius: 6px;
    }
    body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background: var(--background-color); color: var(--text-color); font-size:14px; }
    .container { padding: var(--spacing-md); }
    .header { text-align:center; margin-bottom: var(--spacing-md); }
    .title { color: var(--primary-color); font-size:20px; margin:0; }
    .tagline { font-size:14px; color:#666; margin:0 0 var(--spacing-md) 0; }
    .market-selector { margin-bottom: var(--spacing-md); }
    .market-selector select { width:100%; padding:8px; border:1px solid var(--border-color); border-radius: var(--border-radius); }
    .button { width:100%; padding:12px; background:var(--primary-color); color:#fff; border:none; border-radius: var(--border-radius); font-size:14px; cursor:pointer; }
    .button:disabled { background:#ccc; cursor:not-allowed; }
    .status { display:none; margin-top: var(--spacing-md); padding:12px; border-radius: var(--border-radius); font-size:14px; word-wrap:break-word; }
    .status.success { background:rgba(0,168,107,0.1); color:var(--success-color); border:1px solid var(--success-color); }
    .status.error { background:rgba(242,72,34,0.1); color:var(--error-color); border:1px solid var(--error-color); }
    .status.rate-limit { background:rgba(255,171,0,0.1); color:#FFAB00; border:1px solid #FFAB00; }
    .status.progress { background:rgba(255,65,0,0.1); color:var(--primary-color); border:1px solid var(--primary-color); }
    .spinner { display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,0.3); border-top-color:#fff; border-radius:50%; animation:spin 1s linear infinite; margin-right:8px; vertical-align:middle; }
    @keyframes spin { to { transform:rotate(360deg);} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">LLA UX Translator</h1>
    </div>
    <p class="tagline">
      This plugin helps UX designers translate interface copy from English to Spanish, adapting tone and vocabulary to specific LLA markets.
    </p>

    <div class="market-selector">
      <label for="market">Market:</label>
      <select id="market">
        <option value="Panama">Panama</option>
        <option value="Puerto Rico">Puerto Rico</option>
      </select>
    </div>

    <button id="translate-btn" class="button">
      <span class="button-content">
        <span class="spinner" style="display:none;"></span>
        <span class="button-text">Translate Selection</span>
      </span>
    </button>

    <div id="status" class="status"></div>
  </div>
<!-- somewhere before your closing </body> -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
<script>
  const SUPABASE_URL      = 'https://zgjgcxeduimaexmyrtpy.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpnamdjeGVkdWltYWV4bXlydHB5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxNTk0MjAsImV4cCI6MjA2NzczNTQyMH0.K0icJO6aty6DDFMUlCP9tDTFQnhH8EbccY4mmVZUuK0';
  const supabaseClient    = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

   window.addEventListener('message', async ({ data }) => {
    const m = data.pluginMessage;
    if (m?.type !== 'request-country-log') return;
    // … inserción en tabla …
    console.log('[UI] Supabase log ✔️');
  
    const { market, pluginVersion, userName, nodeCount } = m.payload;

    // 1) figure out country
    let country = 'Unknown';
    try {
      const r = await fetch('https://ipapi.co/json/');
      country = (await r.json()).country_name || country;
    } catch {}

    // 2) write to your table
    const { error } = await supabaseClient
      .from('plugin_usage')
      .insert([{
        market,
        user_name: userName,
        node_count: nodeCount,
        country
      }]);

    if (error) {
      console.error('[UI] Supabase log error:', error);
    } else {
      console.log('[UI] Supabase log ✔️');
    }
  });
</script>

  <script>
    const btn = document.getElementById('translate-btn');
    const marketSelect = document.getElementById('market');
    const statusDiv = document.getElementById('status');
    let loading = false;

    function setLoading(on) {
      loading = on;
      btn.disabled = on;
      btn.querySelector('.spinner').style.display = on ? 'inline-block' : 'none';
      btn.querySelector('.button-text').textContent = on ? 'Translating…' : 'Translate Selection';
      if (on) {
        statusDiv.className = 'status progress';
        statusDiv.textContent = 'Starting translation…';
        statusDiv.style.display = 'block';
      }
    }

    function showStatus(msg, type='success', details='') {
      statusDiv.className = `status ${type}`;
      statusDiv.innerHTML = msg + (details ? `<div class="error-details">${details}</div>` : '');
      statusDiv.style.display = 'block';
    }

    btn.onclick = () => {
      if (loading) return;
      setLoading(true);
      parent.postMessage({
        pluginMessage: {
          type: 'translate',
          market: marketSelect.value
        }
      }, '*');
    };

    window.onmessage = ({ data }) => {
      const m = data.pluginMessage;
      if (!m) return;
      switch (m.type) {
        case 'progress':
          showStatus(m.message, 'progress');
          break;
        case 'error':
          setLoading(false);
          showStatus(m.message, 'error');
          break;
        case 'rate-limit':
          setLoading(false);
          showStatus(`Rate limit. Try again in ${m.retryAfter}s`, 'rate-limit');
          break;
        case 'complete':
          setLoading(false);
          break;
        case 'success':
          setLoading(false);
          showStatus(m.message, 'success');
          break;
      }
      
    };
  </script>
</body>
</html>